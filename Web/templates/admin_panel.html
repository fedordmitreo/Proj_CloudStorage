<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Montserrat', sans-serif;
    }

    body {
      background-color: #f4f4f9;
      color: #333;
    }

    .container {
      max-width: 1000px;
      margin: 40px auto;
      padding: 20px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-bottom: 20px;
      border-bottom: 1px solid #ddd;
      margin-bottom: 30px;
      color: #007BFF;
    }

    h1 {
      font-size: 24px;
    }

    .logout {
      background: #6c757d;
      color: white;
      padding: 8px 16px;
      text-decoration: none;
      border-radius: 5px;
      font-size: 14px;
    }

    .logout:hover {
      background: #5a6268;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      border-radius: 8px;
      overflow: hidden;
    }

    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }

    th {
      background-color: #007BFF;
      color: white;
      font-weight: 600;
    }

    tr:hover {
      background-color: #f1f5f9;
    }

    .badge {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
    }

    .badge.admin {
      background-color: #ffc107;
      color: #212529;
    }

    .badge.user {
      background-color: #28a745;
      color: white;
    }

    .btn-clear, .btn-delete {
      padding: 6px 10px;
      border: none;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
    }

    .btn-clear {
      background: #f1c40f;
      color: #212529;
    }

    .btn-delete {
      background: #e74c3c;
      color: white;
      margin-left: 5px;
    }

    .btn-clear:hover {
      background: #e6b800;
    }

    .btn-delete:hover {
      background: #c0392b;
    }

    .actions {
      white-space: nowrap;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Äî {{ admin_name }}</h1>
      <a href="{{ url_for('home') }}" class="logout">–í—ã—Ö–æ–¥</a>
    </header>

    <h2>–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h2>
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>–ò–º—è</th>
          <th>Email</th>
          <th>–†–æ–ª—å</th>
          <th class="actions">–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
      </thead>
      <tbody>
        {% for user in users %}
          <tr>
            <td>{{ user[0] }}</td>
            <td>{{ user[1] }}</td>
            <td>{{ user[2] }}</td>
            <td>
              {% if user[3] %}
                <span class="badge admin">–ê–¥–º–∏–Ω</span>
              {% else %}
                <span class="badge user">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>
              {% endif %}
            </td>
            <td class="actions">
              <button class="btn-clear" data-userid="{{ user[0] }}" title="–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
                üßπ –û—á–∏—Å—Ç–∏—Ç—å —Ñ–∞–π–ª—ã
              </button>
              {% if not user[3] %}
                <button class="btn-delete" data-userid="{{ user[0] }}" title="–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≤—Å–µ –µ–≥–æ —Ñ–∞–π–ª—ã">
                  üóë –£–¥–∞–ª–∏—Ç—å
                </button>
              {% else %}
                <span style="font-size:12px; color:#aaa; font-style:italic;">(–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ)</span>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <script>
    // –û—á–∏—Å—Ç–∏—Ç—å —Ñ–∞–π–ª—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    document.querySelectorAll(".btn-clear").forEach(button => {
      button.addEventListener("click", function () {
        const userId = this.getAttribute("data-userid");
        const userName = this.closest("tr").querySelector("td:nth-child(2)").textContent.trim();

        if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –í–°–ï —Ñ–∞–π–ª—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è #${userId} (${userName})? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.`)) {
          return;
        }

        fetch(`/admin/clear_user_files/${userId}`, { method: "POST" })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              alert(data.message);
            } else {
              alert("–û—à–∏–±–∫–∞: " + data.message);
            }
          })
          .catch(err => {
            console.error("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏:", err);
            alert("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É.");
          });
      });
    });

    // –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –µ–≥–æ —Ñ–∞–π–ª—ã
    document.querySelectorAll(".btn-delete").forEach(button => {
      button.addEventListener("click", function () {
        const userId = this.getAttribute("data-userid");
        const userName = this.closest("tr").querySelector("td:nth-child(2)").textContent.trim();

        if (!confirm(`‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –í—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å –£–î–ê–õ–ò–¢–¨ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è #${userId} (${userName}) –∏ –í–°–ï –µ–≥–æ —Ñ–∞–π–ª—ã.\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.\n\n–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?`)) {
          return;
        }

        fetch(`/admin/delete_user/${userId}`, { method: "POST" })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              alert(data.message);
              location.reload(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è
            } else {
              alert("–û—à–∏–±–∫–∞: " + data.message);
            }
          })
          .catch(err => {
            console.error("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏:", err);
            alert("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É.");
          });
      });
    });
  </script>
</body>
</html>